<div class="user-management-container">
  <app-navigation></app-navigation>

  <div class="content">
    <h1>All Users</h1>

    <mat-card *ngIf="loading" class="loading-card">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Loading users...</p>
    </mat-card>

    <mat-card *ngIf="!loading">
      <table mat-table [dataSource]="users" class="users-table">
        <ng-container matColumnDef="username">
          <th mat-header-cell *matHeaderCellDef>Username</th>
          <td mat-cell *matCellDef="let user">{{ user.username }}</td>
        </ng-container>

        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let user">{{ user.email }}</td>
        </ng-container>

        <ng-container matColumnDef="role">
          <th mat-header-cell *matHeaderCellDef>Role</th>
          <td mat-cell *matCellDef="let user">
            <mat-chip [color]="user.role === 'ADMIN' ? 'warn' : 'accent'">
              {{ user.role }}
            </mat-chip>
          </td>
        </ng-container>

        <ng-container matColumnDef="enabled">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let user">
            <mat-chip [color]="user.enabled ? 'accent' : 'warn'">
              {{ user.enabled ? 'Active' : 'Inactive' }}
            </mat-chip>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Action</th>
          <td mat-cell *matCellDef="let user">
            <button 
              mat-button 
              *ngIf="user.enabled && user.username !== currentUsername && !loading"
              (click)="toggleUserStatus(user)"
              [disabled]="loading"
              class="deactivate-btn">
              DEACTIVATE
            </button>
            <button 
              mat-button 
              *ngIf="!user.enabled && user.username !== currentUsername && !loading"
              (click)="toggleUserStatus(user)"
              [disabled]="loading"
              class="activate-btn">
              ACTIVATE
            </button>
            <span *ngIf="user.username === currentUsername || loading" class="no-action">-</span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <div *ngIf="users.length === 0" class="empty-state">
        <mat-icon>people</mat-icon>
        <p>No users found.</p>
      </div>
    </mat-card>
  </div>
</div>
